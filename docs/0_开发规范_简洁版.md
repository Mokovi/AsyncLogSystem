# 开发规范 (简洁版)

## 1. 代码风格规范

### 1.1 命名规范

#### 1.1.1 类名
- 使用**PascalCase**命名法
- 类名应该是名词，清晰表达类的职责
- 接口类命名约定：
  - 使用`I`前缀（如`ILogOutput`）：便于识别纯虚接口，与C#风格一致

#### 1.1.2 函数名
- 使用**camelCase**命名法
- 函数名应该是动词或动词短语
- 布尔函数以`is`、`has`、`can`等开头

#### 1.1.3 变量名
- 使用**camelCase**命名法
- 成员变量以`_`结尾
- 常量使用**UPPER_SNAKE_CASE**

#### 1.1.4 文件名
- 使用**camelCase**命名法
- 头文件扩展名约定：
  - 普通头文件：`.h`或`.hpp`（推荐`.hpp`，明确表示C++头文件）
  - 模板实现文件：`.tpp`或`.ipp`（避免ODR问题）
- 源文件使用`.cpp`扩展名
- 测试文件以`test`开头
- 示例文件以`example`或`demo`开头

#### 1.1.5 命名空间
- 使用**snake_case**命名法
- 避免过深的嵌套

### 1.2 格式规范

#### 1.2.1 缩进和空格
- 使用4个空格进行缩进，不使用Tab
- 操作符前后加空格
- 逗号后加空格
- 函数参数列表过长时换行对齐

#### 1.2.2 大括号风格
- 使用**K&R风格**（开括号不换行）
- 控制语句必须使用大括号，即使只有一条语句

#### 1.2.3 行长度
- 每行代码不超过120个字符
- 超过时进行适当的换行和缩进

### 1.3 类型规范

#### 1.3.1 类型别名
- 使用`using`而不是`typedef`
- 类型别名使用**PascalCase**命名法（与类名保持一致）

#### 1.3.2 现代C++习惯
- **智能指针使用**：优先使用`std::unique_ptr`，需要共享所有权时使用`std::shared_ptr`，避免使用裸指针
- **空指针**：使用`nullptr`而非`NULL`或`0`
- **函数重写**：重写虚函数时必须加`override`，必要时加`final`
- **异常安全**：公共API上标注`noexcept`（若不抛异常）
- **常量表达式**：尽量使用`constexpr`/`consteval`
- **拷贝控制**：遵循Rule of Zero/Five，明确`=delete`、`=default`、`noexcept`要求

## 2. 头文件规范

### 2.1 Header Guard
- 推荐使用`#pragma once`（简单且广泛支持）

### 2.2 Include顺序和规则
- 严格按照以下顺序包含头文件：
  1. 当前模块头文件
  2. 本项目其他头文件
  3. 第三方库头文件
  4. 标准库头文件
- 采用"包含你所使用的"（Include What You Use）原则
- 每个分组之间用空行分隔

## 3. Doxygen注释规范

### 3.1 文件头注释
每个源文件和头文件都必须包含标准的Doxygen文件头注释，包括`@file`、`@brief`、`@author`、`@date`、`@version`、`@details`、`@see`、`@since`等标签。

### 3.2 类注释
每个类都必须有详细的Doxygen注释说明，包括`@brief`、`@details`、`@note`、`@warning`、`@see`、`@since`、`@example`等标签。

### 3.3 函数注释
公共接口函数必须有详细的Doxygen注释，包括`@brief`、`@details`、`@param[in/out/inout]`、`@return`、`@throws`、`@note`、`@warning`、`@pre`、`@post`、`@see`、`@since`等标签。

### 3.4 枚举和常量注释
枚举和常量必须有Doxygen注释，使用`///<`行尾注释格式。

### 3.5 成员变量注释
重要的成员变量应该有Doxygen注释，说明其用途和特性。

### 3.6 模板类注释
模板类需要特殊的Doxygen注释格式，使用`@tparam`标签说明模板参数。

### 3.7 命名空间注释
命名空间应该有Doxygen注释，说明其包含的组件和功能。

### 3.8 内联注释
复杂逻辑需要添加内联注释，使用`//`或`/* */`格式。

### 3.9 Doxygen标签使用规范

#### 3.9.1 必需标签
以下标签在所有注释中都必须使用：
- `@brief`: 简短描述（一行）
- `@details`: 详细描述（多行）
- `@param[in/out/inout]`: 参数说明
- `@return`: 返回值说明
- `@since`: 版本信息

#### 3.9.2 可选标签
根据具体情况使用：
- `@note`: 重要说明
- `@warning`: 警告信息
- `@pre`: 前置条件
- `@post`: 后置条件
- `@throws`: 异常说明
- `@see`: 相关引用
- `@example`: 使用示例
- `@tparam`: 模板参数（模板类专用）

#### 3.9.3 特殊注释
- `///<`: 行尾注释，用于简单说明
- `//!`: 行尾注释的另一种形式
- `/*!`: 块注释的开始

### 3.10 Doxygen配置文件
项目根目录必须包含`Doxyfile`配置文件，配置输入输出目录、提取选项、图表生成等。

## 4. 异常和错误处理规范

### 4.1 异常使用策略
- **何时抛异常**：库边界和公共API抛异常处理不可恢复的错误，内部循环/高性能路径返回错误码
- **异常安全等级**：basic guarantee（基本保证）、strong guarantee（强保证）、no-throw guarantee（不抛异常保证）
- **noexcept使用**：析构函数应当`noexcept`

### 4.2 错误码
- 对于可恢复的错误，使用错误码
- 定义清晰的错误码枚举
- 提供错误码到错误信息的映射

## 5. 并发和线程安全规范

### 5.1 线程安全设计指南
- **锁的粒度**：锁的粒度要尽可能小，避免长时间持有锁
- **原子变量**：简单操作使用`std::atomic`，复杂操作使用锁
- **条件变量**：使用`std::condition_variable`进行线程同步
- **避免死锁**：固定锁的获取顺序，使用`try_lock`避免长时间等待，避免在持有锁期间进行阻塞操作

### 5.2 线程注解规范
- 在注释中使用`@threadsafe`标注线程安全的函数
- 使用`@not_threadsafe`标注非线程安全的函数
- 考虑使用clang Thread Safety Analysis进行静态分析

## 6. 性能规范

### 6.1 内存管理
- 避免频繁的内存分配和释放
- 使用对象池管理频繁创建的对象
- 合理使用移动语义

### 6.2 算法优化
- 选择合适的容器和算法
- 避免在循环中进行不必要的计算
- 使用引用避免拷贝

### 7 CMake最佳实践
- **out-of-source构建**：构建目录与源码目录分离
- **精确依赖管理**：使用`INTERFACE`/`PUBLIC`/`PRIVATE`精确表明依赖关系
- **目标配置**：使用`target_include_directories`和`target_link_libraries`

## 8. 测试规范

### 8.1 单元测试
- 每个公共接口都要有对应的单元测试
- 测试覆盖率不低于80%
- 使用Google Test框架

### 8.2 集成测试
- 测试组件间的协作
- 测试异常情况下的系统行为
- 测试性能指标

## 9. 文档规范

### 9.1 文档分类

#### 9.1.1 技术文档
- **项目说明**: 项目简介、需求说明、技术栈、技术难点、技术指标
- **架构文档**: 系统整体架构、组件关系、项目目录
- **设计文档**: 具体模块的设计思路和实现方案
- **开发计划**: 具体到类的项目开发计划（以最小可运行产物 → 增量扩展 → 性能/可维护性增强为原则）
- **API文档**: 详细的接口说明和使用方法
- **部署文档**: 环境配置和部署步骤

#### 9.1.2 用户文档
- **用户手册**: 最终用户的使用指南
- **快速开始**: 快速上手教程
- **常见问题**: FAQ和故障排除


### 9.2 文档维护规范

#### 9.2.1 更新频率
- **API文档**: 每次接口变更后立即更新
- **设计文档**: 设计变更后及时更新
- **用户文档**: 功能发布后同步更新
- **开发文档**: 定期检查和更新



